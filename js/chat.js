var lastMessageSenderID="";var addMessage=function(showProfileLink,senderName,senderImageURL,senderID,messageText,color,icon,icon_url){var profileURL="http://steamcommunity.com/profiles/"+ senderID;var children=$("#messages").children();var maxSize=$("#chatbox").attr("data");var count=$('.msg_content').length;if(count>=maxSize){$(".msg:first-child").remove();}
if(senderID===lastMessageSenderID){var previousLast=null;if(children.length>0){previousLast=$("#messages").children().last();}
var msgContent=previousLast.find(".msg_content");msgContent.append("<br>");msgContent.append(messageText);}else{var hasIcon=icon&&icon_url&&icon.length>0&&icon_url.length>0;var htmlValue="<div class=\"msg\">"+"<div class=\"hdr_msg\">"+"<ul>"+"<li>"+"<img src=\""+ senderImageURL+"\"/>"+"</li>"+"<li>"+"<div class='hdr_sender'>"+"<a "+(showProfileLink?"href=\""+ profileURL+"\" target=\"_blank\"":"")+"style=\"color: "+ color+";";if(hasIcon){htmlValue+="top:-4px;";}
htmlValue+="\">"+ senderName;htmlValue+="</a>";if(hasIcon){htmlValue+="<a href=\""+ icon_url+"\" style='position: relative; top: 1px'><img src=\""+ getAssetURL("img/"+ icon)+"\"/></a>";}
htmlValue+="</div>";htmlValue+="</li>";htmlValue+="</div>"+"<div class=\"msg_content\">"+
messageText+"</div>"+"</div>";if(children.length>0){var previousLast=$("#messages").children().last();previousLast.css('margin-bottom','10px');}
$("#messages").append(htmlValue);}
var msgDiv=$("#messages");msgDiv.scrollTop(msgDiv[0].scrollHeight);lastMessageSenderID=senderID;emojify.run(document.getElementById('messages'));};var submitMessage=function(){var messageInput=$("#chat_message_input");var msg=messageInput.val();if(msg.length!=0){doSend('chat'+ messageInput.val());messageInput.val("");}};$(document).ready(function(){var messageSubmit=$("#chat_message_submit");var messageInput=$("#chat_message_input");messageSubmit.click(submitMessage);messageInput.on('keydown',function(e){if(e.which==13){submitMessage();}});});function resizeChat(){var contentDiv=$(".content");var chatMessageInput=$("#chat_message_input");var chatMessageButton=$("#chat_message_submit");var centerSection=$("#section_center");var headerHeight=$("#hdr").height()+ contentDiv.height()+ 1;var chatBox=$('#chatbox');$('#chat_message_input').css('width',chatBox.width()- 24- chatMessageButton.width()- 2- 15);centerSection.css('width','100%').css('width','-='+ chatBox.width());var mainApp=$('.app_main');mainApp.css('top',headerHeight);}
$(window).load(resizeChat);$(window).resize(resizeChat);